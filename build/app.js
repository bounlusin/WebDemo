"use strict";var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var Koa=require("koa"),router=require("koa-simple-router"),serve=require("koa-static"),path=require("path"),render=require("koa-swig"),koaBody=require("koa-body"),co=require("co"),axios=require("axios"),qs=require("qs"),app=new Koa;app.use(serve(path.join(__dirname,"./assets"))),app.use(koaBody()),app.context.render=co.wrap(render({root:path.join(__dirname,"./views"),autoescape:!0,cache:"memory",ext:"html",writeBody:!1}));var PHP_BASE_URL="http://47.104.252.140:2000/api/",action_config={add:"添加",edit:"保存"};app.use(router(function(e){var t,n,a,o,s;e.get("/",(t=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r,t){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.render("./index/pages/index.html",{username:"koa"});case 2:r.body=e.sent;case 3:case"end":return e.stop()}},e,void 0)})),function(e,r){return t.apply(this,arguments)})),e.get("/getList",(n=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r,t){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,axios.get(PHP_BASE_URL+"books.php").then(function(e){return e.data});case 2:r.body=e.sent;case 3:case"end":return e.stop()}},e,void 0)})),function(e,r){return n.apply(this,arguments)})),e.get("/form",(a=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r,t){var n,a;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.query.action,a=action_config[n],e.next=4,r.render("./form/pages/form.html",{action:a});case 4:r.body=e.sent;case 5:case"end":return e.stop()}},e,void 0)})),function(e,r){return a.apply(this,arguments)})),e.post("/save",(o=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r,t){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,axios.post(PHP_BASE_URL+"book.php",qs.stringify(r.request.body)).then(function(e){return console.log(e.data),e.data});case 2:r.body=e.sent;case 3:case"end":return e.stop()}},e,void 0)})),function(e,r){return o.apply(this,arguments)})),e.delete("/delete/:bookid",(s=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r,t){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("node删除"+r.params.bookid),e.next=3,axios.delete(PHP_BASE_URL+"/book.php",{bookId:r.params.bookid}).then(function(e){return console.log(e.data),e.data});case 3:r.body=e.sent;case 4:case"end":return e.stop()}},e,void 0)})),function(e,r){return s.apply(this,arguments)}))})),app.listen(3e3,function(){console.log("serve is started..")});